---
import { getCollection } from "astro:content";
import Layout from "../layouts/Layout.astro";
import EventCard from "../components/EventCard.astro";
import Hero from "../components/Hero.astro";

// Fetch and sort events by date (newest/upcoming first)
const allEvents = await getCollection("events");
const upcomingEvents = allEvents
  .filter((event) => new Date(event.data.date) >= new Date()) // In a real app, you might want to show past events too, or filter them out.
  .sort(
    (a, b) => new Date(a.data.date).valueOf() - new Date(b.data.date).valueOf(),
  );

const base = import.meta.env.BASE_URL;
---

<Layout title="Upcoming Events">
  <Hero activePage="events" />

  <section id="events" class="events-section">
    <h2>Upcoming Events</h2>

    {
      upcomingEvents.length === 0 ? (
        <div class="glass-panel text-center empty-state">
          <p>No upcoming events found. Check back later or submit your own!</p>
          <a
            href={`${base}/submit`}
            class="btn btn-primary"
            style="margin-top: 1rem;"
          >
            Submit an Event
          </a>
        </div>
      ) : (
        <div class="events-list">
          {upcomingEvents.map((event) => (
            <EventCard event={event} />
          ))}
        </div>
      )
    }
  </section>
</Layout>

<style>
  .empty-state {
    padding: 4rem 2rem;
  }

  .events-section h2 {
    font-size: 2rem;
    margin-bottom: 2rem;
    position: relative;
    display: inline-block;
  }

  .events-section h2::after {
    content: "";
    position: absolute;
    bottom: -10px;
    left: 0;
    width: 50px;
    height: 4px;
    background: var(--accent-gradient);
    border-radius: 2px;
  }
</style>

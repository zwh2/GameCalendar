---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Submit an Event">
  <div class="submit-container">
    <div class="text-center intro">
      <h1 class="text-gradient">Submit an Event</h1>
      <p class="subtitle">
        Know about a local board game night? Let us know and we'll add it to the
        calendar!
      </p>
    </div>

    <div class="glass-panel form-wrapper">
      <!-- We use Formspree since this is a static site. -->
      <form action="" method="POST" id="submitForm" class="event-form">
        <!-- Formspree Redirect Configuration -->
        <input
          type="hidden"
          name="_next"
          value="https://zhudson.github.io/GameCalendar/success"
        />
        <div class="form-group">
          <label for="title">Event Title <span class="required">*</span></label>
          <input
            type="text"
            id="title"
            name="title"
            required
            placeholder="e.g., Downtown Board Game Night"
            class="form-input"
          />
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="date">Date <span class="required">*</span></label>
            <input
              type="date"
              id="date"
              name="date"
              required
              class="form-input"
            />
          </div>
          <div class="form-group">
            <label>Time <span class="required">*</span></label>
            <div style="display: flex; gap: 0.5rem; align-items: center;">
              <input
                type="time"
                id="startTime"
                name="startTime"
                required
                class="form-input"
                style="flex: 1;"
                step="60"
              />
              <span style="color: var(--text-secondary);">to</span>
              <input
                type="time"
                id="endTime"
                name="endTime"
                required
                class="form-input"
                style="flex: 1;"
                step="60"
              />
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="location"
              >Location <span class="required">*</span></label
            >
            <input
              type="text"
              id="location"
              name="location"
              required
              placeholder="e.g., Downtown Library - Room C"
              class="form-input"
            />
          </div>
          <div class="form-group">
            <label for="organizerLink">Organizer Link</label>
            <input
              type="url"
              id="organizerLink"
              name="organizerLink"
              placeholder="https://meetup.com/..."
              class="form-input"
            />
          </div>
        </div>

        <div class="form-group">
          <label for="description"
            >Short Description <span class="required">*</span></label
          >
          <input
            type="text"
            id="description"
            name="description"
            required
            placeholder="A brief 1-2 sentence summary for the event card..."
            class="form-input"
          />
        </div>

        <div class="form-group">
          <label for="body">Event Text (Optional)</label>
          <textarea
            id="body"
            name="body"
            rows="6"
            placeholder="Full details, schedule, what to bring... (Markdown supported)"
            class="form-input"></textarea>
        </div>

        <div class="form-info">
          <p>
            All submissions are reviewed manually before being posted to the
            site.
          </p>
        </div>

        <button type="submit" class="btn btn-primary submit-btn"
          >Submit Event for Review</button
        >
      </form>
    </div>
  </div>
</Layout>

<script>
  const form = document.getElementById("submitForm") as HTMLFormElement;
  const submitBtn = document.querySelector(".submit-btn") as HTMLButtonElement;

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    submitBtn.textContent = "Submitting...";
    submitBtn.disabled = true;

    try {
      const formData = new FormData(form);

      // POST to the Google Apps Script Web App
      await fetch(
        "https://script.google.com/macros/s/AKfycbznflNUtglKfLYljc_BZ3IiPZ3rCeDEocBzjeCeuGc-weqWrnK90Aua7dVEKfOJ4E9boA/exec",
        {
          method: "POST",
          body: formData,
          mode: "no-cors",
        },
      );

      const baseUrl = import.meta.env.BASE_URL;
      window.location.href = `${baseUrl}/success`;
    } catch (err) {
      console.error(err);
      alert("Network error. Please try again.");
      submitBtn.textContent = "Submit Event for Review";
      submitBtn.disabled = false;
    }
  });
</script>

<style>
  .submit-container {
    max-width: 700px;
    margin: 0 auto;
    padding: 2rem 0;
  }

  .intro {
    margin-bottom: 3rem;
  }

  .intro h1 {
    font-size: 3rem;
    margin-bottom: 1rem;
  }

  .form-wrapper {
    padding: 2.5rem;
  }

  /* Disable the hover "pop-out" for the large form container */
  .form-wrapper.glass-panel:hover {
    transform: none;
    box-shadow: var(--glass-shadow);
    background: var(--bg-surface);
    border: var(--glass-border);
  }

  .event-form {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }

  .form-group {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  label {
    font-weight: 600;
    color: var(--text-primary);
    font-size: 0.95rem;
  }

  .required {
    color: var(--accent-primary);
  }

  .form-input {
    background: rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 8px;
    padding: 0.75rem 1rem;
    color: var(--text-primary);
    font-family: var(--font-family);
    font-size: 1rem;
    transition: var(--transition);
  }

  .form-input:focus {
    outline: none;
    border-color: var(--accent-primary);
    box-shadow: 0 0 0 2px rgba(189, 147, 249, 0.2);
    background: rgba(0, 0, 0, 0.4);
  }

  .form-input::placeholder {
    color: var(--text-muted);
  }

  textarea.form-input {
    resize: vertical;
  }

  .form-info {
    background: rgba(139, 233, 253, 0.1);
    border-left: 4px solid var(--accent-secondary);
    padding: 1rem;
    border-radius: 0 8px 8px 0;
    font-size: 0.9rem;
    color: var(--text-secondary);
  }

  .submit-btn {
    margin-top: 1rem;
    font-size: 1.1rem;
    padding: 1rem;
  }

  @media (max-width: 600px) {
    .form-row {
      grid-template-columns: 1fr;
    }
    .form-wrapper {
      padding: 1.5rem;
    }
  }
</style>
